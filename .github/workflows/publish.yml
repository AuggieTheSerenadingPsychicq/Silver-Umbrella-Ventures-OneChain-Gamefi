name: OneChain Deployment

on:
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Install and Publish
        env:
          # IMPORTANT: Hardcoding your key here to bypass any environment variable parsing errors
          MOVE_PRIVATE_KEY: suiprivkey1qqhklekz5kss5uxrwp992zn39avwxyzqhtd7866algys5reqyxejwqk7g87
        run: |
          # Install Sui CLI and dependencies
          curl -sS https://packagecloud.io/install/repositories/neondapp/sui-cli/script.deb.sh | sudo bash
          sudo apt-get update
          sudo apt-get install -y sui-cli

          # Set the RPC URL to the OneChain Testnet
          export SUI_RPC_URL='https://rpc-testnet.onelabs.cc:443'

          # Import the private key for the CLI
          echo "$MOVE_PRIVATE_KEY" > sui_key.txt
          sui keytool import-private-key --key-file sui_key.txt --env testnet

          # Publish the Move Package
          echo "Starting final publish transaction on OneChain Testnet..."
          sui move publish --gas-budget 20000000 --json
